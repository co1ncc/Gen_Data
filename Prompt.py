import json

# ====== 证型和症状范围 ======
Tongjing = {
    "气滞血瘀证": {
        "治疗方案": "选择太冲、血海、次髎、膈俞穴进行施灸。施灸时，艾条点燃的一端与施灸部位皮肤的距离并不固定，而是如鸟雀啄食一样上下活动。上述穴位每处灸10分钟左右，至皮肤红晕为度。痛经发作期可每日治疗1-2次，非发作期可隔日治疗1次。",
        "气滞血瘀证_一级": {
            "小腹胀痛拒按": ["小腹疼痛胀满", "按压小腹疼痛加重"],
            "胸胁胀痛": ["胸部及胁肋部胀满疼痛疼痛不适"],
            "乳房胀痛": ["胸部一侧或两侧乳房部位发胀、疼痛", "胸胀"],
            "胸闷不舒": ["胸部满闷", "呼吸不畅", "胸闷", "胸部有压迫感"]
        },
        "气滞血瘀证_二级": {
            "血色紫黯有块,块下痛减": ["月经血色紫暗或深红，质地稠厚，夹杂血块，血块排出后腹痛减轻"],
            "经血量少": ["月经量少"],
            "行而不畅": ["经血排出不畅", "点滴难下"]
        },
        "气滞血瘀证_三级": {
            "经行头痛": ["经期或月经前后出现头痛"],
            "易生闷气": [],
            "情绪抑郁或急躁易怒": [],
            "喜叹息": [],
            "胃脘部腹部胀满刺痛": [],
            "小腹刺痛": [],
            "肌肤甲错": ["皮肤干燥、粗糙、脱屑如鱼鳞", "甲片交错"],
            "面色黎黑": ["面色黑而晦暗"],
            "皮肤瘀斑、紫癜、四肢见紫暗血络": ["皮肤或黏膜下出现点状、片状青紫或暗红色瘀斑", "上肢/下肢局部见有暗红色，或紫色血络，或浅浮单支，或密集成网状"],
            "肢体麻木": ["肢体局部或四肢甚至躯干有木僵感、或蚁行感、或针刺感，麻木伴肢端发凉、或麻木伴灼热感，位置固定，常于夜间加重"],
            "口唇、指甲青紫": [],
        }
    },
    "寒凝血瘀证": {
        "治疗方案": "选择神阙、关元、归来、地机穴进行施灸。先将纯净干燥的食盐填于神阙穴中，使之与脐平，再点燃艾条，施灸时，艾条点燃的一端与施灸部位皮肤保持一定距离，但艾条并不固定而是左右移动或反复旋转施灸。痛经发作期可每日治疗1-2次，非发作期可隔日治疗1次。",
        "寒凝血瘀证_一级": {
            "小腹冷痛拒按": ["小腹怕冷", "按压小腹疼痛加重", "小腹受凉疼痛加重"],
            "得热痛减": ["受热后疼痛减轻"],
        },
        "寒凝血瘀证_二级": {
            "月经色暗有瘀块": ["月经颜色暗", "月经血块多"],
            "月经推后": ["月经推迟"],
            "月经量少": [],
            "肢冷畏寒": ["手脚寒冷", "怕冷"],
            "面色青白": ["面色青暗", "面色苍白带青"],
        },
        "寒凝血瘀证_三级": {
            "关节、腰背部、腹部刺痛、或冷痛": [],
            "口唇、指甲青紫": [],
            "肌肤甲错": ["皮肤干燥、粗糙、脱屑如鱼鳞", "甲片交错"],
            "面色黎黑": ["面色黑而晦暗"],
            "皮肤瘀斑、紫癜、四肢见紫暗血络": ["皮肤或黏膜下出现点状、片状青紫或暗红色瘀斑", "上肢/下肢局部见有暗红色", "紫色血络", "浅浮单支", "密集成网状"],
            "肢体麻木": ["肢体局部或四肢甚至躯干有木僵感、或蚁行感、或针刺感", "麻木伴肢端发凉、或麻木伴灼热感", "位置固定，常于夜间加重"]
        }
    },
    "湿热蕴结证": {
        "治疗方案": "选择曲池、大椎、三阴交穴进行手指点按。用拇指指腹在穴位上逆时针点揉，力度适中偏沉，频率60-90次/分钟，每个穴位操作1分钟，快速收力。整套操作需避开经期量多时段，以感觉穴位酸胀无剧痛为度，每日2-3次",
        "湿热蕴结证_一级": {
            "小腹灼痛胀痛": ["小腹热痛拒按", "痛连腰骶"],
            "有灼烧感": ["灼热感腹痛"]
        },
        "湿热蕴结证_二级": {
            "经血量多或经期延长，色黯红，质稠或夹黏液": ["经色黯红、质稠夹黏液、血块腐臭、经量多或经期长"],
            "平素带下量多，色黄质稠有臭味": ["带下色黄如脓、质稠量多、气味秽浊"],
            "平时小腹疼痛，经前加剧": [],
        },
        "湿热蕴结证_三级": {
            "低热起伏，低热持续不退，午后尤甚": ["经前低热、午后发热明显"],
            "小便短赤灼热，尿道涩痛": ["尿道灼热", "尿色黄赤、尿道灼热、尿频尿急"],
            "纳呆腹胀，大便黏滞不爽，肢体困重，神疲乏力": [],
            "口苦口黏，口臭，阴部瘙痒、灼热感，带下夹血丝": [],
            "大便黏滞不爽": [],
            "经血夹大量紫暗血块，小腹刺痛拒按，固定不移": []
        }
    },
    "气血虚弱证": {
        "治疗方案": "选择气海、血海、三阴交、足三里穴进行施灸。点燃艾条，将艾条点燃的一端对准穴位，距皮肤2-3厘米，使穴位局部有温热感而无灼痛为宜。上述穴位每处灸10-15分钟左右，至皮肤红晕为度。痛经发作期可每日治疗1-2次，非发作期可隔日治疗1次。",
        "气血虚弱证_一级": {
            "小腹隐隐作痛": ["小腹绵痛", "腹痛时作时止"],
            "小腹及阴部空坠不适": ["坠胀不适"]
        },
        "气血虚弱证_二级": {
            "月经量少，色淡，质清稀": ["经行量少", "月经量不多", "色淡", "经色浅淡", "质稀薄", "质清稀"],
            "面色无华，头晕心悸，神疲乏力": ["面色苍白", "面色萎黄", "头昏", "心悸", "心慌", "神疲", "倦怠乏力"],
            "腹痛喜按": []
        },
        "气血虚弱证_三级": {
            "气短懒言,食欲不振": [],
            "失眠多梦，爪甲淡白": [],
            "手足麻木，大便溏薄": [],
            "记忆力减退": []
        }
    },
    "阳虚内寒证": {
        "治疗方案": "选择肾俞、命门、关元、神阙穴进行施灸。先将纯净干燥的食盐填于神阙穴中，使之与脐平，再点燃艾条，将艾条点燃的一端对准穴位，距皮肤2-3厘米，使穴位局部有温热感而无灼痛为宜。上述穴位每处灸10-15分钟左右，至皮肤红晕为度。痛经发作期可每日治疗1-2次，非发作期可隔日治疗1次。",
        "阳虚内寒证_一级": {
            "小腹冷痛": ["小腹冷冷作痛", "腹部冷痛"],
            "喜温喜按": ["痛处喜按", "喜温喜按", "喜揉", "用手按（揉）肚子舒服点（些）"]
        },
        "阳虚内寒证_二级": {
            "月经后期，经量少，色黯淡质稀": ["经行量少、行经量少、经少、月经稀少、月经量不多", "色黯、经色黯淡、经色淡黯、色淡暗、月经黯淡"],
            "畏寒肢冷,四肢不温": ["形寒肢冷、肢体寒冷、肢体冰凉、手脚冰凉", "肢体不温、四肢欠温、四肢不暖和"],
            "小便清长,大便溏薄": ["小便清冷、便冷", "便溏、大便溏、大便稀溏、大便稀薄"],
        },
        "阳虚内寒证_三级": {
            "精神萎靡,倦怠乏力": ["精神萎靡"],
            "面色苍白或晄白": ["面色白", "面色苍白"],
            "口淡不渴,喜热饮": [],
            "夜尿频多": [],
            "性欲减退,宫寒不孕": []
        }
    },
    "肝肾亏损证": {
        "治疗方案": "选择肾俞、太溪、肝俞、十七椎穴进行施灸。点燃艾条，将艾条点燃的一端对准穴位，距皮肤2-3厘米，使穴位局部有温热感而无灼痛为宜。上述穴位每处灸10-15分钟左右，至皮肤红晕为度。痛经发作期可每日治疗1-2次，非发作期可隔日治疗1次。",
        "肝肾亏损证_一级": {
            "小腹绵绵作痛": ["小腹绵痛", "腹痛绵绵", "腹痛时作时止"],
            "腰酸": ["腰酸腿软", "腰膝酸软", "腰部酸痛", "腰骶酸", "腰骶酸痛"]
        },
        "肝肾亏损证_二级": {
            "月经量少，色淡暗，质稀": ["经行量少、行经量少、经少、月经稀少、月经量不多", "色黯、经色黯淡、经色淡黯、色淡暗、月经黯淡", "经少", "质稀薄、质淡"],
            "头晕耳鸣，面色晦暗，失眠健忘": ["头昏、头部晕、脑壳晕、头眩晕", "耳响", "耳朵嗡嗡声", "面色黯淡、面色晦涩、面部晦暗", "不寐、睡不着、难以入眠（睡）、入睡困难、睡眠浅、（睡后）易醒", "记忆（力）差、记忆（力）不好、记性差、记性不好（行）、容易忘事、忘性大"],
            "腹痛喜按": ["痛处喜按", "喜温喜按", "喜揉", "用手按肚子舒服点"],
        },
        "肝肾亏损证_三级": {
            "视力减退，眼干涩，视物模糊": [],
            "头发早白": [],
            "头发干枯": [],
            # "头发易脱落": [],
            # "牙齿松动": [],
            # "口燥咽干": [],
            # "形体消瘦": [],
            # "皮肤干燥": [],
            # "肢体麻木": [],
            # "五心烦热": [],
            # "潮热、盗汗": [],
            # "午后颧红": [],
            # "性欲减退": [],
            # "倦怠乏力": []
        }
    }

}

# ====== 角色系统提示（负样本版） ======
Doctor_prompt = """你是资深中医师（望闻问切+辨证论治），主题为“痛经的排除性辨证”。要求：
- 语气专业、简洁；每轮仅输出一段中文；不得加角色前缀；严禁在输出中加入任何角色前缀（如“医生：”“患者：”等）；直接给内容。
- 仅可使用【知识库.Tongjing】的“一级/二级/三级症状”及其示例同义进行提问或复述；禁止库外扩展与自造症状。
- 可围绕四诊要点提问（起病时间、部位、性质、寒热、汗、口渴、食欲、二便、睡眠、情志等），但涉及到的具体症状词必须来自【知识库】。
- 若患者使用库外表述：给出1-2个与当前排除判断最相关的库内候选症状供其选择。
- 过程目标：通过多轮有针对性的排除性追问，优先核查痛经关键要点（经期时效性、痛势强度与持续时间、量色质变化、拒按/喜按、伴随要点如腰骶酸痛、头晕耳鸣、失眠健忘、面色晦暗等），引导识别“时机不符、要点缺失、轻微短暂、非经期或生理性诱因”等排除线索。
- 在非终轮阶段：只可以进行追问，严禁做出倾向性判断。
- 终轮（当用户声明“这是最后一次医生发言”）仅执行：
  ① 给出否定性结论（如“未见痛经相关证候 / 暂不支持痛经辨证”）；
  ② 列出否定依据（例如：经期不加重、经量经色经质正常、疼痛轻微且短暂可自缓、缺乏关键聚合要点等，均需从对话事实中提取）；
  ③ 给出生活方式与必要他科评估的建议（如作息、运动拉伸、减少久坐、注意饮食寒凉、可行运动医学/消化科评估等）；
  严禁提供任何“治疗方案”或处方信息。
- 严禁确诊或开处方，仅限科普与建议；全程保持排除性思路，避免误导性肯定。
""" + "\n# 知识库.Tongjing（只读，严禁越界）\n" + json.dumps(Tongjing, ensure_ascii=False)

Patient_prompt = """你是一位求诊患者（用于“痛经排除性辨证”的负样本数据）。要求：
- 在第一轮时，描述自身主要患有1-2个来自【知识库.Tongjing】的二级症状。
- 尽量从否定的角度进行回答，让医生最后的诊断结果为没患病。
- 真实、具体描述自我感受；按医生追问补充；每轮仅输出一段中文；不得加角色前缀；严禁在输出中加入任何角色前缀；直接给内容。
- 症状用语仅能来自【知识库.Tongjing】的症状名称或其示例同义；可组合/转述，但不得新增库外症状。
- 当医生给出库内候选项时，若你的真实情况不符合，可用“无/未见/不明显/不在经期/很快缓解”等否定性表达来回应（否定性用语不视为新增症状）。
- 信息维度可含：起病诱因/时间、部位、程度、规律、加重或缓解因素、伴随症状、既往史、作息饮食、情绪压力自述等；但涉及到的具体症状词必须来自【知识库】。
- 表达倾向：尽量呈现经期或经期不加重、症状轻微短暂可自缓，并可出现生理性诱因（如久坐、运动后短暂不适、进食寒凉后短暂不适等）。
- 禁止主动拼凑任何一个完整痛经证型的典型组合；若无把握，优先说明“未见/不明显/无持续影响”。
""" + "\n# 知识库.Tongjing（只读，严禁越界）\n" + json.dumps(Tongjing, ensure_ascii=False)

